/*
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license agreements.  See the NOTICE file distributed with
 * this work for additional information regarding copyright ownership.
 * The ASF licenses this file to You under the Apache License, Version 2.0
 * (the "License"); you may not use this file except in compliance with
 * the License.  You may obtain a copy of the License at
 *
 *    http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

package org.apache.spark.examples.ml

// scalastyle:off println
// $example on$
import org.apache.spark.ml.clustering.LDA
// $example off$
import org.apache.spark.sql.SparkSession

/**
 * An example demonstrating LDA.
  * 隐含狄利克雷分布（英语：Latent Dirichlet allocation，简称LDA），是一种主题模型。
  * 目前在文本挖掘领域包括文本主题识别、文本分类以及文本相似度计算方面都有应用。
 * Run with
 * {{{
 * bin/run-example ml.LDAExample
 * }}}
 */
object LDAExample {
  def main(args: Array[String]): Unit = {
    // Creates a SparkSession
    val spark = SparkSession
      .builder
      .appName(s"${this.getClass.getSimpleName}")
      .getOrCreate()

    // $example on$
    // Loads data.
    val dataset = spark.read.format("libsvm")
      .load("data/mllib/sample_lda_libsvm_data.txt")

    // Trains a LDA model.
    val lda = new LDA().setK(10).setMaxIter(10)
    val model = lda.fit(dataset)

    val ll = model.logLikelihood(dataset)
    val lp = model.logPerplexity(dataset)
    println(s"The lower bound on the log likelihood of the entire corpus: $ll")
    println(s"The upper bound on perplexity: $lp")

    // Describe topics.
    val topics = model.describeTopics(3)
    println("The topics described by their top-weighted terms:")
    topics.show(false)

    // Shows the result.
    val transformed = model.transform(dataset)
    transformed.show(false)
    // $example off$

    spark.stop()
  }
}
// scalastyle:on println


/*
数据及结果：
sample_lda_data.txt
1 2 6 0 2 3 1 1 0 0 3
1 3 0 1 3 0 0 2 0 0 1
1 4 1 0 0 4 9 0 1 2 0
2 1 0 3 0 0 5 0 2 3 9
3 1 1 9 3 0 2 0 0 1 3
4 2 0 3 4 5 1 1 1 4 0
2 1 0 3 0 0 5 0 2 2 9
1 1 1 9 2 1 2 0 0 1 3
4 4 0 3 4 2 1 3 0 0 0
2 8 2 0 3 0 2 0 2 7 2
1 1 1 9 0 2 2 0 0 3 3
4 1 0 0 4 5 1 3 0 1 0


+-----+-----------+---------------------------------------------------------------+
|topic|termIndices|termWeights                                                    |
+-----+-----------+---------------------------------------------------------------+
|0    |[2, 5, 7]  |[0.10606441785153495, 0.10570106737292916, 0.10430390179120429]|
|1    |[1, 6, 2]  |[0.10185078330695455, 0.09816924136524595, 0.09632455347731934]|
|2    |[1, 9, 4]  |[0.10597705560327189, 0.09750947009740057, 0.09654669260364386]|
|3    |[0, 4, 8]  |[0.1027069837677028, 0.09842850173334589, 0.09815664110633743] |
|4    |[9, 6, 4]  |[0.10452968226818589, 0.10414903763050086, 0.10103989134999738]|
|5    |[10, 6, 9] |[0.21878768113719402, 0.14074681595465477, 0.12767399434876692]|
|6    |[3, 7, 4]  |[0.11638316021404858, 0.09901763897403078, 0.09795374111270025]|
|7    |[4, 0, 2]  |[0.10855455833994969, 0.10334271299447197, 0.10034944281890695]|
|8    |[0, 7, 8]  |[0.11008004098642224, 0.0991972423606346, 0.09810905351562402] |
|9    |[9, 6, 8]  |[0.10106113658479517, 0.1001329156487897, 0.09769280655828362] |
+-----+-----------+---------------------------------------------------------------+

+-----+---------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|label|features                                                       |topicDistribution                                                                                                                                                                                                      |
+-----+---------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|0.0  |(11,[0,1,2,4,5,6,7,10],[1.0,2.0,6.0,2.0,3.0,1.0,1.0,3.0])      |[0.6990327167257029,0.004825989048470543,0.004825952656204991,0.004825954172960102,0.004825928240785008,0.2623596585838084,0.004825954958317321,0.004826025731539115,0.004825893928983133,0.00482592595322841]         |
|1.0  |(11,[0,1,3,4,7,10],[1.0,3.0,1.0,3.0,2.0,1.0])                  |[0.00805010984374918,0.008049931119606024,0.008049953004186655,0.3080440983708963,0.008049883649287179,0.627555715385603,0.00805016876357647,0.008050175111768221,0.008050094815593633,0.008049869935733388]           |
|2.0  |(11,[0,1,2,5,6,8,9],[1.0,4.0,1.0,4.0,9.0,1.0,2.0])             |[0.004196214364845041,0.004196664428909277,0.004196054901025511,0.004196139254289826,0.004195975702627526,0.9622349002234255,0.00419607764394594,0.00419604084872728,0.004195889666097846,0.004196042966106348]        |
|3.0  |(11,[0,1,3,6,8,9,10],[2.0,1.0,3.0,5.0,2.0,3.0,9.0])            |[0.003710822000177833,0.003710864646142239,0.0037108462502701066,0.003710882147288795,0.0037110028349074346,0.966602056981526,0.003710875285997691,0.003710837981632638,0.0037109099445878967,0.0037109019274692142]   |
|4.0  |(11,[0,1,2,3,4,6,9,10],[3.0,1.0,1.0,9.0,3.0,2.0,1.0,3.0])      |[0.004020614595200912,0.004020653634885415,0.004020643759542166,0.004020676200341724,0.004020733809703303,0.9638139508847741,0.004020799549947044,0.004020655257090115,0.004020667768794552,0.004020604539720746]      |
|5.0  |(11,[0,1,3,4,5,6,7,8,9],[4.0,2.0,3.0,4.0,5.0,1.0,1.0,1.0,4.0]) |[0.0037112916460784774,0.003711268512305513,0.0037112510787934553,0.5957985345096222,0.0037112771700049153,0.37451131776246716,0.0037112922674202146,0.0037112963089796693,0.0037112589761407427,0.0037112117681877325]|
|6.0  |(11,[0,1,3,6,8,9,10],[2.0,1.0,3.0,5.0,2.0,2.0,9.0])            |[0.00385939588246117,0.0038594459099053824,0.003859422469257207,0.0038594613768570024,0.003859577828667109,0.965264892637739,0.003859457053862342,0.0038594138251897025,0.003859475960796919,0.003859457055264223]     |
|7.0  |(11,[0,1,2,3,4,5,6,9,10],[1.0,1.0,1.0,9.0,2.0,1.0,2.0,1.0,3.0])|[0.004386712535459854,0.004386715372256842,0.0043866963277775835,0.004386722567290665,0.004386733359206259,0.960519580766777,0.0043868678553220285,0.004386665049317367,0.004386653391728801,0.004386652774863607]     |
|8.0  |(11,[0,1,3,4,5,6,7],[4.0,4.0,3.0,4.0,2.0,1.0,3.0])             |[0.004386785810152442,0.004386801108348701,0.004386765033670605,0.7222015445977727,0.004386759696274845,0.24270414910213708,0.0043868581982543986,0.00438681598682528,0.004386801516482532,0.004386718950081159]       |
|9.0  |(11,[0,1,2,4,6,8,9,10],[2.0,8.0,2.0,3.0,2.0,2.0,7.0,2.0])      |[0.003326815878832243,0.0033268245444246025,0.0033268322072966925,0.003326811196535193,0.003326881763873095,0.970058596019814,0.0033267726242188086,0.0033268507851061343,0.0033268076259272456,0.0033268073539719535] |
|10.0 |(11,[0,1,2,3,5,6,9,10],[1.0,1.0,1.0,9.0,2.0,2.0,3.0,3.0])      |[0.0041958924053097195,0.004195869073730862,0.004195828672249276,0.004195855863799033,0.004195821712633375,0.9622373627875639,0.004196022397947433,0.004195769511201903,0.004195762038798466,0.004195815536766164]     |
|11.0 |(11,[0,1,4,5,6,7,9],[4.0,1.0,4.0,5.0,1.0,3.0,1.0])             |[0.004826024023341997,0.004825967274109287,0.0048259179592302194,0.9559711337123036,0.004825945507504251,0.0054210995994604496,0.00482596729957779,0.004826080963323669,0.004825980026004433,0.004825883635144604]     |
+-----+---------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
*/
